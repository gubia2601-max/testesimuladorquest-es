<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PQO Risco ‚Äî Simulador Pro</title>

  <!-- Fonte -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <style>
    :root{
      /* Nova paleta mais moderna */
      --bg: #f8fafc;
      --panel: #ffffff;
      --panel-2: #f1f5f9;
      
      --text: #0f172a;
      --muted: #64748b;
      
      --border: #e2e8f0;
      --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.01);
      --shadow-lg: 0 20px 40px -10px rgba(0, 0, 0, 0.08);
      
      --primary-900: #1e3a8a;
      --primary-800: #1e40af;
      --primary-700: #1d4ed8;
      --primary-600: #2563eb;
      --primary-500: #3b82f6;
      --primary-100: #dbeafe;
      --primary-50: #eff6ff;
      
      --success-700: #15803d;
      --success-600: #16a34a;
      --success-500: #22c55e;
      --success-100: #dcfce7;
      
      --warning-600: #d97706;
      --warning-500: #f59e0b;
      
      --danger-600: #dc2626;
      --danger-500: #ef4444;
      --danger-100: #fee2e2;
      
      --radius-lg: 16px;
      --radius-md: 12px;
      --radius-sm: 8px;
      
      --sidebar-w: 280px;
      --topbar-h: 64px;
    }

    *{ box-sizing: border-box; margin: 0; padding: 0; }
    html, body{ height: 100%; font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; }
    body{
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
      overflow-x: hidden;
    }

    /* ===== Layout Principal ===== */
    .app{
      display: grid;
      grid-template-columns: var(--sidebar-w) 1fr;
      min-height: 100vh;
      transition: grid-template-columns 0.3s ease;
    }
    .app.exam-mode{ grid-template-columns: 0 1fr; }
    .app.exam-mode .sidebar{ transform: translateX(-100%); }

    /* ===== Sidebar ===== */
    .sidebar{
      background: white;
      border-right: 1px solid var(--border);
      box-shadow: var(--shadow);
      padding: 20px 16px;
      overflow-y: auto;
      position: sticky;
      top: 0;
      height: 100vh;
      transition: transform 0.3s ease;
      z-index: 40;
    }

    .brand{
      display: flex;
      align-items: center;
      gap: 12px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 20px;
    }
    .brand-icon{
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, var(--primary-600), var(--primary-800));
      border-radius: var(--radius-md);
      display: grid;
      place-items: center;
      color: white;
      font-weight: 900;
      font-size: 18px;
    }
    .brand-text h1{
      font-size: 16px;
      font-weight: 900;
      line-height: 1.2;
      color: var(--primary-900);
    }
    .brand-text small{
      font-size: 11px;
      color: var(--muted);
      font-weight: 600;
    }

    .nav-section{
      margin-bottom: 24px;
    }
    .section-title{
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--muted);
      margin-bottom: 12px;
      padding-left: 8px;
    }

    .nav-item{
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 14px;
      border-radius: var(--radius-md);
      background: transparent;
      border: 1px solid transparent;
      color: var(--text);
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-bottom: 6px;
      text-decoration: none;
    }
    .nav-item:hover{
      background: var(--primary-50);
      border-color: var(--primary-100);
    }
    .nav-item.active{
      background: var(--primary-50);
      border-color: var(--primary-200);
      color: var(--primary-700);
      font-weight: 700;
    }
    .nav-item .badge{
      background: var(--primary-100);
      color: var(--primary-700);
      font-size: 11px;
      font-weight: 800;
      padding: 2px 8px;
      border-radius: 20px;
    }

    .switch-group{
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 12px;
      border-radius: var(--radius-md);
      background: var(--panel-2);
      margin-bottom: 8px;
      border: 1px solid var(--border);
    }
    .switch-label{
      font-size: 13px;
      font-weight: 600;
      color: var(--text);
    }
    .switch{
      width: 44px;
      height: 24px;
      background: #cbd5e1;
      border-radius: 12px;
      position: relative;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    .switch.on{
      background: var(--primary-500);
    }
    .switch::after{
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      transition: transform 0.2s ease;
    }
    .switch.on::after{
      transform: translateX(20px);
    }

    .stats-card{
      background: linear-gradient(135deg, var(--primary-50), var(--primary-100));
      border: 1px solid var(--primary-200);
      border-radius: var(--radius-lg);
      padding: 16px;
      margin-top: 20px;
    }
    .stat{
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .stat:last-child{ margin-bottom: 0; }
    .stat-label{
      font-size: 13px;
      color: var(--primary-800);
      font-weight: 600;
    }
    .stat-value{
      font-size: 15px;
      font-weight: 800;
      color: var(--primary-900);
    }

    /* ===== Topbar ===== */
    .topbar{
      height: var(--topbar-h);
      background: white;
      border-bottom: 1px solid var(--border);
      padding: 0 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 30;
      box-shadow: var(--shadow);
    }
    .page-title h2{
      font-size: 18px;
      font-weight: 800;
      color: var(--primary-900);
      margin-bottom: 2px;
    }
    .page-title p{
      font-size: 12px;
      color: var(--muted);
      font-weight: 500;
    }

    .topbar-controls{
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .topbar-chip{
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 12px;
      background: var(--panel-2);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      font-size: 13px;
      font-weight: 600;
    }
    .topbar-chip strong{
      color: var(--primary-700);
    }

    .btn{
      padding: 10px 16px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      background: white;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
    }
    .btn:hover{
      transform: translateY(-1px);
      box-shadow: var(--shadow);
    }
    .btn-primary{
      background: var(--primary-600);
      border-color: var(--primary-600);
      color: white;
    }
    .btn-primary:hover{
      background: var(--primary-700);
    }
    .btn-success{
      background: var(--success-600);
      border-color: var(--success-600);
      color: white;
    }
    .btn-danger{
      background: white;
      border-color: var(--danger-500);
      color: var(--danger-600);
    }
    .btn-ghost{
      background: transparent;
      border-color: var(--border);
      color: var(--text);
    }

    /* ===== Views ===== */
    .view{
      display: none;
      height: calc(100vh - var(--topbar-h));
      overflow-y: auto;
      padding: 24px;
    }
    .view.active{
      display: block;
    }

    /* ===== Login View ===== */
    .login-container{
      max-width: 400px;
      margin: 60px auto;
      padding: 40px;
      background: white;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      border: 1px solid var(--border);
    }
    .login-header{
      text-align: center;
      margin-bottom: 32px;
    }
    .login-header h1{
      font-size: 24px;
      color: var(--primary-900);
      margin-bottom: 8px;
    }
    .login-header p{
      color: var(--muted);
      font-size: 14px;
    }
    .form-group{
      margin-bottom: 20px;
    }
    .form-group label{
      display: block;
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 6px;
      color: var(--text);
    }
    .form-control{
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      font-size: 14px;
      transition: all 0.2s;
    }
    .form-control:focus{
      outline: none;
      border-color: var(--primary-500);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    .form-check{
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 20px;
    }
    .form-check label{
      font-size: 14px;
      color: var(--muted);
    }
    .login-footer{
      text-align: center;
      margin-top: 24px;
      font-size: 13px;
      color: var(--muted);
    }

    /* ===== Home View ===== */
    .hero-section{
      background: linear-gradient(135deg, var(--primary-50), white);
      border-radius: var(--radius-lg);
      padding: 40px;
      margin-bottom: 32px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
    }
    .hero-title{
      font-size: 32px;
      font-weight: 900;
      color: var(--primary-900);
      margin-bottom: 12px;
    }
    .hero-subtitle{
      font-size: 16px;
      color: var(--muted);
      max-width: 600px;
      margin-bottom: 32px;
    }

    .action-grid{
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }
    .action-card{
      background: white;
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 24px;
      transition: all 0.3s ease;
      cursor: pointer;
      text-decoration: none;
      color: inherit;
    }
    .action-card:hover{
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
      border-color: var(--primary-300);
    }
    .action-icon{
      width: 48px;
      height: 48px;
      background: var(--primary-100);
      border-radius: var(--radius-md);
      display: grid;
      place-items: center;
      margin-bottom: 16px;
      color: var(--primary-600);
      font-size: 20px;
    }
    .action-card h3{
      font-size: 18px;
      font-weight: 800;
      margin-bottom: 8px;
      color: var(--primary-900);
    }
    .action-card p{
      font-size: 14px;
      color: var(--muted);
      line-height: 1.5;
    }

    .stats-grid{
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-top: 32px;
    }
    .stat-card{
      background: white;
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 20px;
      text-align: center;
    }
    .stat-card .value{
      font-size: 32px;
      font-weight: 900;
      color: var(--primary-700);
      margin-bottom: 4px;
    }
    .stat-card .label{
      font-size: 13px;
      color: var(--muted);
      font-weight: 600;
    }

    /* ===== Quiz View ===== */
    .quiz-container{
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .quiz-header{
      padding: 20px 24px;
      border-bottom: 1px solid var(--border);
      background: linear-gradient(to right, var(--primary-50), white);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .quiz-progress{
      font-size: 14px;
      font-weight: 600;
      color: var(--primary-700);
    }
    .quiz-timer{
      font-size: 14px;
      font-weight: 700;
      color: var(--primary-900);
      background: white;
      padding: 6px 12px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
    }

    .question-container{
      padding: 32px;
    }
    .question-meta{
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }
    .question-tag{
      padding: 4px 12px;
      background: var(--panel-2);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      font-size: 12px;
      font-weight: 600;
      color: var(--muted);
    }
    .question-title{
      font-size: 20px;
      font-weight: 700;
      color: var(--primary-900);
      margin-bottom: 16px;
    }
    .question-text{
      font-size: 16px;
      line-height: 1.6;
      color: var(--text);
      margin-bottom: 32px;
      background: var(--panel-2);
      padding: 20px;
      border-radius: var(--radius-md);
      border-left: 4px solid var(--primary-500);
    }

    .options-container{
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 32px;
    }
    .option{
      display: flex;
      align-items: flex-start;
      gap: 16px;
      padding: 16px 20px;
      background: white;
      border: 2px solid var(--border);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
    }
    .option:hover{
      border-color: var(--primary-300);
      background: var(--primary-50);
    }
    .option.selected{
      border-color: var(--primary-500);
      background: var(--primary-50);
    }
    .option.correct{
      border-color: var(--success-500);
      background: var(--success-100);
    }
    .option.incorrect{
      border-color: var(--danger-500);
      background: var(--danger-100);
    }
    .option.disabled{
      opacity: 0.5;
      cursor: not-allowed;
    }
    .option.disabled .option-text{
      text-decoration: line-through;
      color: var(--muted);
    }
    .option-letter{
      width: 32px;
      height: 32px;
      background: var(--panel-2);
      border-radius: var(--radius-sm);
      display: grid;
      place-items: center;
      font-weight: 800;
      color: var(--primary-700);
      flex-shrink: 0;
    }
    .option.correct .option-letter{
      background: var(--success-500);
      color: white;
    }
    .option.incorrect .option-letter{
      background: var(--danger-500);
      color: white;
    }
    .option-text{
      flex: 1;
      font-size: 15px;
      line-height: 1.5;
      color: var(--text);
    }
    .option-remove{
      position: absolute;
      top: 8px;
      right: 8px;
      width: 24px;
      height: 24px;
      background: var(--panel-2);
      border-radius: var(--radius-sm);
      display: grid;
      place-items: center;
      color: var(--muted);
      cursor: pointer;
      transition: all 0.2s;
      border: none;
    }
    .option-remove:hover{
      background: var(--danger-100);
      color: var(--danger-600);
    }

    .quiz-actions{
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 32px;
      padding-top: 24px;
      border-top: 1px solid var(--border);
    }

    .explanation-box{
      margin-top: 24px;
      padding: 20px;
      background: var(--success-100);
      border: 1px solid var(--success-500);
      border-radius: var(--radius-md);
      display: none;
    }
    .explanation-box.show{
      display: block;
    }
    .explanation-title{
      font-weight: 700;
      color: var(--success-700);
      margin-bottom: 8px;
    }
    .explanation-text{
      font-size: 14px;
      line-height: 1.6;
      color: var(--text);
    }

    /* ===== Exam Mode ===== */
    .exam-overlay{
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.98);
      z-index: 1000;
      display: none;
      flex-direction: column;
    }
    .exam-overlay.active{
      display: flex;
    }
    .exam-header{
      padding: 16px 24px;
      border-bottom: 2px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: white;
    }
    .exam-timer{
      font-size: 18px;
      font-weight: 900;
      color: var(--primary-900);
    }
    .exam-progress{
      font-size: 14px;
      font-weight: 600;
      color: var(--primary-700);
    }
    .exam-container{
      flex: 1;
      overflow-y: auto;
      padding: 40px;
      max-width: 1000px;
      margin: 0 auto;
      width: 100%;
    }

    /* ===== Dashboard View ===== */
    .dashboard-header{
      background: white;
      border-radius: var(--radius-lg);
      padding: 24px;
      margin-bottom: 24px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
    }
    .dashboard-title{
      font-size: 24px;
      font-weight: 900;
      color: var(--primary-900);
      margin-bottom: 8px;
    }
    .dashboard-stats{
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-top: 24px;
    }
    .dashboard-stat{
      text-align: center;
      padding: 20px;
      background: white;
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
    }
    .dashboard-stat .value{
      font-size: 36px;
      font-weight: 900;
      margin-bottom: 4px;
    }
    .dashboard-stat .value.positive{
      color: var(--success-600);
    }
    .dashboard-stat .value.negative{
      color: var(--danger-600);
    }
    .dashboard-stat .label{
      font-size: 14px;
      color: var(--muted);
      font-weight: 600;
    }

    .chart-container{
      background: white;
      border-radius: var(--radius-lg);
      padding: 24px;
      margin-bottom: 24px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
    }
    .chart-title{
      font-size: 18px;
      font-weight: 800;
      color: var(--primary-900);
      margin-bottom: 16px;
    }

    /* ===== Modal ===== */
    .modal-backdrop{
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      padding: 20px;
    }
    .modal-backdrop.active{
      display: flex;
    }
    .modal{
      background: white;
      border-radius: var(--radius-lg);
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--shadow-lg);
    }
    .modal-header{
      padding: 20px 24px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .modal-title{
      font-size: 18px;
      font-weight: 800;
      color: var(--primary-900);
    }
    .modal-body{
      padding: 24px;
    }
    .modal-footer{
      padding: 20px 24px;
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }

    /* ===== Loading ===== */
    .loading{
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid var(--border);
      border-top-color: var(--primary-600);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin{
      to{ transform: rotate(360deg); }
    }

    /* ===== Responsive ===== */
    @media (max-width: 768px){
      .app{ grid-template-columns: 1fr; }
      .sidebar{ display: none; }
      .view{ padding: 16px; }
      .hero-section{ padding: 24px; }
      .action-grid{ grid-template-columns: 1fr; }
      .quiz-actions{ flex-direction: column; }
      .btn{ width: 100%; }
    }
  </style>
</head>

<body>
  <!-- ========================= APP CONTAINER ========================= -->
  <div id="app" class="app">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="brand">
        <div class="brand-icon">PQO</div>
        <div class="brand-text">
          <h1>PQO Risco Pro</h1>
          <small>Simulador Inteligente</small>
        </div>
      </div>

      <div class="nav-section">
        <div class="section-title">Navega√ß√£o</div>
        <button class="nav-item" data-view="home">
          In√≠cio
          <span class="badge" id="navHomeBadge">üè†</span>
        </button>
        <button class="nav-item" data-view="quiz" id="navQuiz">
          Simulado
          <span class="badge" id="navQuizBadge">0</span>
        </button>
        <button class="nav-item" data-view="dashboard" id="navDashboard">
          Dashboard
          <span class="badge" id="navDashboardBadge">üìä</span>
        </button>
      </div>

      <div class="nav-section">
        <div class="section-title">Prefer√™ncias</div>
        <div class="switch-group">
          <span class="switch-label">N√£o repetir</span>
          <div class="switch" id="switchNoRepeat" role="switch" aria-checked="false"></div>
        </div>
        <div class="switch-group">
          <span class="switch-label">Embaralhar</span>
          <div class="switch" id="switchShuffle" role="switch" aria-checked="true"></div>
        </div>
        <div class="switch-group">
          <span class="switch-label">Explica√ß√µes</span>
          <div class="switch" id="switchExplain" role="switch" aria-checked="true"></div>
        </div>
        <div class="switch-group">
          <span class="switch-label">Modo Prova</span>
          <div class="switch" id="switchExam" role="switch" aria-checked="false"></div>
        </div>
      </div>

      <div class="nav-section">
        <div class="section-title">Conta</div>
        <button class="nav-item" id="btnLogout">
          <span>Sair</span>
          <span class="badge">üë§</span>
        </button>
        <button class="nav-item btn-danger" id="btnResetData">
          <span>Limpar Dados</span>
        </button>
      </div>

      <div class="stats-card">
        <div class="section-title">Estat√≠sticas</div>
        <div class="stat">
          <span class="stat-label">Progresso</span>
          <span class="stat-value" id="statProgress">0/0</span>
        </div>
        <div class="stat">
          <span class="stat-label">Acertos</span>
          <span class="stat-value" id="statAccuracy">0%</span>
        </div>
        <div class="stat">
          <span class="stat-label">Tempo</span>
          <span class="stat-value" id="statTime">00:00</span>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Topbar -->
      <header class="topbar">
        <div class="page-title">
          <h2 id="pageTitle">Bem-vindo ao PQO Risco</h2>
          <p id="pageSubtitle">Fa√ßa login para come√ßar</p>
        </div>
        
        <div class="topbar-controls">
          <div class="topbar-chip">
            <span>Quest√µes:</span>
            <strong id="topbarQuestions">0</strong>
          </div>
          <div class="topbar-chip">
            <span>Modo:</span>
            <strong id="topbarMode">Treino</strong>
          </div>
          <button class="btn btn-ghost" id="btnBackHome">
            ‚Üê Voltar ao In√≠cio
          </button>
        </div>
      </header>

      <!-- Views Container -->
      <div id="viewsContainer">
        <!-- Login View -->
        <div class="view active" id="viewLogin">
          <div class="login-container">
            <div class="login-header">
              <h1>PQO Risco Pro</h1>
              <p>Fa√ßa login para acessar seu progresso</p>
            </div>
            
            <div class="form-group">
              <label for="loginEmail">E-mail</label>
              <input type="email" id="loginEmail" class="form-control" placeholder="seu@email.com">
            </div>
            
            <div class="form-group">
              <label for="loginPassword">Senha</label>
              <input type="password" id="loginPassword" class="form-control" placeholder="Sua senha">
            </div>
            
            <div class="form-check">
              <input type="checkbox" id="rememberLogin">
              <label for="rememberLogin">Lembrar de mim</label>
            </div>
            
            <button class="btn btn-primary" id="btnLogin" style="width: 100%;">
              Entrar
            </button>
            
            <div class="login-footer">
              <p>Demo: Use qualquer e-mail e senha para testar</p>
            </div>
          </div>
        </div>

        <!-- Home View -->
        <div class="view" id="viewHome">
          <div class="hero-section">
            <h1 class="hero-title">Domine o PQO Risco</h1>
            <p class="hero-subtitle">
              Simulador inteligente com quest√µes atualizadas, an√°lise de desempenho 
              e prepara√ß√£o completa para sua certifica√ß√£o.
            </p>
            
            <div class="action-grid">
              <a class="action-card" id="actionNew">
                <div class="action-icon">üìù</div>
                <h3>Novo Simulado</h3>
                <p>Configure filtros, quantidade de quest√µes e comece seu treino personalizado</p>
              </a>
              
              <a class="action-card" id="actionContinue">
                <div class="action-icon">‚èØÔ∏è</div>
                <h3>Continuar</h3>
                <p>Retome de onde parou na sua √∫ltima sess√£o de estudos</p>
              </a>
              
              <a class="action-card" id="actionDashboard">
                <div class="action-icon">üìä</div>
                <h3>Dashboard</h3>
                <p>Analise seu desempenho, taxas de acerto e √°reas que precisa melhorar</p>
              </a>
              
              <a class="action-card" id="actionQuickExam">
                <div class="action-icon">‚ö°</div>
                <h3>Prova R√°pida</h3>
                <p>Simulado de 60 quest√µes com distribui√ß√£o autom√°tica por m√≥dulos</p>
              </a>
            </div>
          </div>

          <div class="stats-grid">
            <div class="stat-card">
              <div class="value" id="statTotalQuestions">0</div>
              <div class="label">Quest√µes na Base</div>
            </div>
            <div class="stat-card">
              <div class="value" id="statAnswered">0</div>
              <div class="label">Respondidas</div>
            </div>
            <div class="stat-card">
              <div class="value" id="statAccuracyHome">0%</div>
              <div class="label">Taxa de Acerto</div>
            </div>
            <div class="stat-card">
              <div class="value" id="statTimeSpent">0h</div>
              <div class="label">Tempo de Estudo</div>
            </div>
          </div>
        </div>

        <!-- Quiz View -->
        <div class="view" id="viewQuiz">
          <div class="quiz-container">
            <div class="quiz-header">
              <div class="quiz-progress" id="quizProgress">Quest√£o 0/0</div>
              <div class="quiz-timer" id="quizTimer">00:00:00</div>
            </div>
            
            <div class="question-container">
              <div id="questionContent">
                <!-- Aqui as quest√µes ser√£o renderizadas dinamicamente -->
              </div>
            </div>
          </div>
        </div>

        <!-- Dashboard View -->
        <div class="view" id="viewDashboard">
          <div class="dashboard-header">
            <h1 class="dashboard-title">Dashboard de Desempenho</h1>
            <p>An√°lise completa do seu progresso e √°reas para melhoria</p>
            
            <div class="dashboard-stats">
              <div class="dashboard-stat">
                <div class="value positive" id="dashboardAccuracy">0%</div>
                <div class="label">Taxa de Acerto</div>
              </div>
              <div class="dashboard-stat">
                <div class="value" id="dashboardTime">00:00</div>
                <div class="label">Tempo Total</div>
              </div>
              <div class="dashboard-stat">
                <div class="value" id="dashboardQuestions">0</div>
                <div class="label">Quest√µes</div>
              </div>
              <div class="dashboard-stat">
                <div class="value" id="dashboardCorrect">0</div>
                <div class="label">Acertos</div>
              </div>
            </div>
          </div>

          <div class="chart-container">
            <h3 class="chart-title">Desempenho por M√≥dulo</h3>
            <canvas id="chartModule" height="300"></canvas>
          </div>

          <div class="chart-container">
            <h3 class="chart-title">Desempenho por Dificuldade</h3>
            <canvas id="chartDifficulty" height="200"></canvas>
          </div>

          <div class="chart-container">
            <h3 class="chart-title">Quest√µes para Revisar</h3>
            <div id="wrongQuestionsList">
              <!-- Lista de quest√µes erradas -->
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- ========================= MODALS ========================= -->
  <!-- Config Modal -->
  <div class="modal-backdrop" id="modalConfig">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Configurar Simulado</h3>
        <button class="btn btn-ghost" id="closeConfig">‚úï</button>
      </div>
      
      <div class="modal-body">
        <div class="form-group">
          <label for="configMode">Modo</label>
          <select id="configMode" class="form-control">
            <option value="treino">Treino</option>
            <option value="prova">Prova (60 quest√µes)</option>
            <option value="custom">Personalizado</option>
          </select>
        </div>

        <div id="customConfig" style="display: none;">
          <div class="form-group">
            <label for="configTotal">Total de Quest√µes</label>
            <input type="number" id="configTotal" class="form-control" min="1" max="200" value="30">
          </div>
          
          <div id="moduleDistribution">
            <!-- Distribui√ß√£o por m√≥dulo ser√° gerada dinamicamente -->
          </div>
        </div>

        <div class="form-group">
          <label for="configModule">M√≥dulo (opcional)</label>
          <select id="configModule" class="form-control">
            <option value="">Todos os m√≥dulos</option>
          </select>
        </div>

        <div class="form-group">
          <label for="configDifficulty">Dificuldade (opcional)</label>
          <select id="configDifficulty" class="form-control">
            <option value="">Todas as dificuldades</option>
            <option value="F√°cil">F√°cil</option>
            <option value="M√©dia">M√©dia</option>
            <option value="Dif√≠cil">Dif√≠cil</option>
          </select>
        </div>

        <div class="form-group">
          <label for="configSearch">Busca por texto (opcional)</label>
          <input type="text" id="configSearch" class="form-control" placeholder="Digite termos para buscar...">
        </div>
      </div>
      
      <div class="modal-footer">
        <button class="btn btn-ghost" id="cancelConfig">Cancelar</button>
        <button class="btn btn-primary" id="startConfig">Iniciar Simulado</button>
      </div>
    </div>
  </div>

  <!-- Exam Overlay (Tela Cheia) -->
  <div class="exam-overlay" id="examOverlay">
    <div class="exam-header">
      <div class="exam-timer" id="examTimer">00:00:00</div>
      <div class="exam-progress" id="examProgress">Quest√£o 0/60</div>
      <button class="btn btn-danger" id="exitExam">Sair da Prova</button>
    </div>
    
    <div class="exam-container" id="examContent">
      <!-- Conte√∫do da prova ser√° renderizado aqui -->
    </div>
  </div>

  <script>
    ;(() => {
      // =========================
      // CONSTANTS & STATE
      // =========================
      const state = {
        user: null,
        questions: [],
        filtered: [],
        queue: [],
        currentIndex: 0,
        currentQuestion: null,
        answers: [],
        session: null,
        timer: null,
        startTime: null,
        elapsedTime: 0,
        
        // Configura√ß√µes
        config: {
          noRepeat: false,
          shuffle: true,
          showExplain: true,
          examMode: false,
          mode: 'treino',
          totalQuestions: 30,
          moduleDist: {}
        },
        
        // Estat√≠sticas
        stats: {
          totalAnswered: 0,
          correctAnswers: 0,
          timeSpent: 0,
          lastSession: null
        }
      };

      // =========================
      // STORAGE KEYS
      // =========================
      const STORAGE_KEYS = {
        USER: 'pqo_user_v2',
        QUESTIONS: 'pqo_questions_v2',
        HISTORY: 'pqo_history_v2',
        SESSION: 'pqo_session_v2',
        STATS: 'pqo_stats_v2',
        CONFIG: 'pqo_config_v2'
      };

      // =========================
      // DOM ELEMENTS
      // =========================
      const els = {
        app: document.getElementById('app'),
        viewsContainer: document.getElementById('viewsContainer'),
        pageTitle: document.getElementById('pageTitle'),
        pageSubtitle: document.getElementById('pageSubtitle'),
        
        // Login
        viewLogin: document.getElementById('viewLogin'),
        btnLogin: document.getElementById('btnLogin'),
        
        // Home
        viewHome: document.getElementById('viewHome'),
        actionNew: document.getElementById('actionNew'),
        actionContinue: document.getElementById('actionContinue'),
        actionDashboard: document.getElementById('actionDashboard'),
        actionQuickExam: document.getElementById('actionQuickExam'),
        
        // Quiz
        viewQuiz: document.getElementById('viewQuiz'),
        questionContent: document.getElementById('questionContent'),
        quizProgress: document.getElementById('quizProgress'),
        quizTimer: document.getElementById('quizTimer'),
        
        // Dashboard
        viewDashboard: document.getElementById('viewDashboard'),
        
        // Config Modal
        modalConfig: document.getElementById('modalConfig'),
        configMode: document.getElementById('configMode'),
        customConfig: document.getElementById('customConfig'),
        configTotal: document.getElementById('configTotal'),
        moduleDistribution: document.getElementById('moduleDistribution'),
        configModule: document.getElementById('configModule'),
        configDifficulty: document.getElementById('configDifficulty'),
        configSearch: document.getElementById('configSearch'),
        startConfig: document.getElementById('startConfig'),
        closeConfig: document.getElementById('closeConfig'),
        cancelConfig: document.getElementById('cancelConfig'),
        
        // Exam Overlay
        examOverlay: document.getElementById('examOverlay'),
        examTimer: document.getElementById('examTimer'),
        examProgress: document.getElementById('examProgress'),
        examContent: document.getElementById('examContent'),
        exitExam: document.getElementById('exitExam'),
        
        // Controls
        btnBackHome: document.getElementById('btnBackHome'),
        btnLogout: document.getElementById('btnLogout'),
        btnResetData: document.getElementById('btnResetData'),
        
        // Switches
        switchNoRepeat: document.getElementById('switchNoRepeat'),
        switchShuffle: document.getElementById('switchShuffle'),
        switchExplain: document.getElementById('switchExplain'),
        switchExam: document.getElementById('switchExam'),
        
        // Stats
        topbarQuestions: document.getElementById('topbarQuestions'),
        topbarMode: document.getElementById('topbarMode'),
        statProgress: document.getElementById('statProgress'),
        statAccuracy: document.getElementById('statAccuracy'),
        statTime: document.getElementById('statTime'),
        statTotalQuestions: document.getElementById('statTotalQuestions'),
        statAnswered: document.getElementById('statAnswered'),
        statAccuracyHome: document.getElementById('statAccuracyHome'),
        statTimeSpent: document.getElementById('statTimeSpent'),
        navQuizBadge: document.getElementById('navQuizBadge'),
        navDashboardBadge: document.getElementById('navDashboardBadge')
      };

      // =========================
      // UTILITIES
      // =========================
      function $(selector) {
        return document.querySelector(selector);
      }

      function $$(selector) {
        return document.querySelectorAll(selector);
      }

      function formatTime(seconds) {
        const h = Math.floor(seconds / 3600);
        const m = Math.floor((seconds % 3600) / 60);
        const s = Math.floor(seconds % 60);
        
        if (h > 0) {
          return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }
        return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
      }

      function normalizeText(text) {
        return (text || '').toString()
          .toLowerCase()
          .normalize('NFD')
          .replace(/[\u0300-\u036f]/g, '');
      }

      function shuffleArray(array) {
        const arr = [...array];
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }

      // =========================
      // STORAGE MANAGEMENT
      // =========================
      function loadFromStorage(key) {
        try {
          const data = localStorage.getItem(key);
          return data ? JSON.parse(data) : null;
        } catch (error) {
          console.error('Erro ao carregar do storage:', error);
          return null;
        }
      }

      function saveToStorage(key, data) {
        try {
          localStorage.setItem(key, JSON.stringify(data));
          return true;
        } catch (error) {
          console.error('Erro ao salvar no storage:', error);
          return false;
        }
      }

      function clearStorage() {
        Object.values(STORAGE_KEYS).forEach(key => {
          localStorage.removeItem(key);
        });
      }

      // =========================
      // LOAD QUESTIONS
      // =========================
      async function loadQuestions() {
        // Primeiro tenta carregar do cache
        const cached = loadFromStorage(STORAGE_KEYS.QUESTIONS);
        if (cached && cached.length > 0) {
          state.questions = cached;
          updateQuestionStats();
          return;
        }

        // Tenta m√∫ltiplas fontes
        const sources = [
          './Quest√µesPQO.json',
          './QuestoesPQO.json',
          './questoes.json',
          './dados.json',
          './questions.json'
        ];

        for (const source of sources) {
          try {
            console.log(`Tentando carregar: ${source}`);
            const response = await fetch(source, { cache: 'no-cache' });
            
            if (response.ok) {
              const data = await response.json();
              const sanitized = sanitizeQuestions(data);
              
              if (sanitized.length > 0) {
                state.questions = sanitized;
                saveToStorage(STORAGE_KEYS.QUESTIONS, sanitized);
                updateQuestionStats();
                console.log(`Carregado: ${sanitized.length} quest√µes de ${source}`);
                return;
              }
            }
          } catch (error) {
            console.warn(`Falha ao carregar ${source}:`, error.message);
          }
        }

        // Fallback para quest√µes de exemplo
        state.questions = getExampleQuestions();
        saveToStorage(STORAGE_KEYS.QUESTIONS, state.questions);
        updateQuestionStats();
        alert('Usando quest√µes de exemplo. Fa√ßa upload do arquivo JSON completo.');
      }

      function sanitizeQuestions(data) {
        const questions = Array.isArray(data) ? data : [];
        const warnings = [];
        const result = [];

        questions.forEach((q, i) => {
          try {
            // Valida√ß√µes b√°sicas
            if (!q.id || !q.q || !q.answer) {
              warnings.push(`Quest√£o ${i} inv√°lida: falta id, texto ou resposta`);
              return;
            }

            const answer = q.answer.toString().trim().toUpperCase();
            const options = q.options || {};
            
            // Verifica se a resposta existe nas op√ß√µes
            if (!options[answer]) {
              warnings.push(`Quest√£o ${q.id}: resposta "${answer}" n√£o encontrada nas op√ß√µes`);
              return;
            }

            result.push({
              id: q.id.toString(),
              module: q.module?.toString() || 'Sem m√≥dulo',
              chapter: q.chapter?.toString() || 'Sem cap√≠tulo',
              theme: q.theme?.toString() || 'Sem tema',
              level: q.level?.toString() || 'M√©dia',
              q: q.q.toString(),
              options: options,
              answer: answer,
              explain: q.explain?.toString() || ''
            });
          } catch (error) {
            warnings.push(`Erro ao processar quest√£o ${i}: ${error.message}`);
          }
        });

        if (warnings.length > 0) {
          console.warn('Avisos no processamento:', warnings);
        }

        return result;
      }

      function getExampleQuestions() {
        return [
          {
            id: "EX001",
            module: "Mercado de Capitais",
            chapter: "Introdu√ß√£o",
            theme: "Conceitos B√°sicos",
            level: "F√°cil",
            q: "O que √© o mercado de capitais?",
            options: {
              A: "Mercado onde se negociam apenas a√ß√µes",
              B: "Mercado de empr√©stimos banc√°rios",
              C: "Mercado de t√≠tulos de d√≠vida de longo prazo",
              D: "Sistema que canaliza poupan√ßa para investimentos produtivos"
            },
            answer: "D",
            explain: "O mercado de capitais √© o sistema que canaliza a poupan√ßa para investimentos produtivos de longo prazo."
          }
        ];
      }

      // =========================
      // USER MANAGEMENT
      // =========================
      function loginUser(email, password) {
        // Em produ√ß√£o, isso seria uma chamada √† API
        // Por enquanto, simula√ß√£o simples
        const user = {
          id: 'user_' + Date.now(),
          email: email,
          name: email.split('@')[0],
          joined: new Date().toISOString(),
          stats: loadFromStorage(STORAGE_KEYS.STATS) || state.stats
        };

        state.user = user;
        saveToStorage(STORAGE_KEYS.USER, user);
        
        // Carrega configura√ß√µes salvas
        const savedConfig = loadFromStorage(STORAGE_KEYS.CONFIG);
        if (savedConfig) {
          state.config = { ...state.config, ...savedConfig };
          updateSwitches();
        }

        showView('home');
        updateUI();
      }

      function logoutUser() {
        state.user = null;
        saveToStorage(STORAGE_KEYS.USER, null);
        showView('login');
      }

      // =========================
      // VIEW MANAGEMENT
      // =========================
      function showView(viewName) {
        // Remove active class de todas as views
        $$('.view').forEach(view => view.classList.remove('active'));
        
        // Adiciona active na view solicitada
        const view = document.getElementById(`view${viewName.charAt(0).toUpperCase() + viewName.slice(1)}`);
        if (view) {
          view.classList.add('active');
          
          // Atualiza t√≠tulo da p√°gina
          switch(viewName) {
            case 'login':
              els.pageTitle.textContent = 'Bem-vindo ao PQO Risco';
              els.pageSubtitle.textContent = 'Fa√ßa login para come√ßar';
              break;
            case 'home':
              els.pageTitle.textContent = 'Dashboard Principal';
              els.pageSubtitle.textContent = 'Gerencie seus simulados e acompanhe seu progresso';
              break;
            case 'quiz':
              els.pageTitle.textContent = 'Simulado em Andamento';
              els.pageSubtitle.textContent = 'Concentre-se nas quest√µes';
              break;
            case 'dashboard':
              els.pageTitle.textContent = 'Dashboard de Desempenho';
              els.pageSubtitle.textContent = 'Analise seus resultados e melhore seu desempenho';
              break;
          }
          
          // Ajusta layout para modo prova
          if (viewName === 'quiz' && state.config.examMode) {
            els.app.classList.add('exam-mode');
          } else {
            els.app.classList.remove('exam-mode');
          }
        }
      }

      // =========================
      // CONFIG MODAL
      // =========================
      function openConfigModal() {
        // Popula m√≥dulos
        const modules = [...new Set(state.questions.map(q => q.module))].sort();
        els.configModule.innerHTML = '<option value="">Todos os m√≥dulos</option>';
        modules.forEach(module => {
          const option = document.createElement('option');
          option.value = module;
          option.textContent = module;
          els.configModule.appendChild(option);
        });

        // Configura listeners do modo
        els.configMode.addEventListener('change', function() {
          const isCustom = this.value === 'custom';
          els.customConfig.style.display = isCustom ? 'block' : 'none';
          
          if (isCustom) {
            generateModuleDistribution();
          }
        });

        els.modalConfig.classList.add('active');
      }

      function generateModuleDistribution() {
        const modules = [...new Set(state.questions.map(q => q.module))].sort();
        const total = parseInt(els.configTotal.value) || 30;
        
        let html = '<h4>Distribui√ß√£o por M√≥dulo (%)</h4>';
        modules.forEach(module => {
          html += `
            <div class="form-group" style="display: flex; align-items: center; gap: 10px;">
              <label style="flex: 1;">${module}</label>
              <input type="number" class="form-control" 
                     style="width: 80px;" 
                     min="0" max="100" 
                     value="${Math.floor(100 / modules.length)}"
                     data-module="${module}">
              <span>%</span>
            </div>
          `;
        });
        
        els.moduleDistribution.innerHTML = html;
      }

      function applyFilters() {
        let filtered = [...state.questions];
        
        // Filtro por m√≥dulo
        const moduleFilter = els.configModule.value;
        if (moduleFilter) {
          filtered = filtered.filter(q => q.module === moduleFilter);
        }
        
        // Filtro por dificuldade
        const difficultyFilter = els.configDifficulty.value;
        if (difficultyFilter) {
          filtered = filtered.filter(q => q.level === difficultyFilter);
        }
        
        // Filtro por texto
        const searchText = els.configSearch.value;
        if (searchText) {
          const searchNorm = normalizeText(searchText);
          filtered = filtered.filter(q => 
            normalizeText(q.q).includes(searchNorm) ||
            normalizeText(q.explain).includes(searchNorm) ||
            Object.values(q.options).some(opt => 
              normalizeText(opt).includes(searchNorm)
            )
          );
        }
        
        // N√£o repetir
        if (state.config.noRepeat) {
          const history = loadFromStorage(STORAGE_KEYS.HISTORY) || [];
          const historySet = new Set(history);
          filtered = filtered.filter(q => !historySet.has(q.id));
        }
        
        state.filtered = filtered;
        return filtered;
      }

      function buildQuestionQueue() {
        const mode = els.configMode.value;
        let questions = applyFilters();
        
        if (questions.length === 0) {
          alert('Nenhuma quest√£o encontrada com os filtros atuais.');
          return false;
        }
        
        // Embaralha se configurado
        if (state.config.shuffle) {
          questions = shuffleArray(questions);
        }
        
        // Aplica distribui√ß√£o baseada no modo
        if (mode === 'prova') {
          // Prova de 60 quest√µes com distribui√ß√£o proporcional
          questions = selectProvaQuestions(questions, 60);
        } else if (mode === 'custom') {
          // Personalizado com distribui√ß√£o por m√≥dulo
          questions = selectCustomQuestions(questions);
        } else {
          // Treino - todas as quest√µes filtradas (limitado a 100)
          questions = questions.slice(0, 100);
        }
        
        state.queue = questions;
        state.currentIndex = 0;
        state.currentQuestion = questions[0];
        state.answers = [];
        state.startTime = Date.now();
        state.elapsedTime = 0;
        
        // Inicia timer
        startTimer();
        
        // Salva sess√£o
        saveSession();
        
        return true;
      }

      function selectProvaQuestions(questions, total = 60) {
        // Agrupa por m√≥dulo
        const byModule = {};
        questions.forEach(q => {
          if (!byModule[q.module]) byModule[q.module] = [];
          byModule[q.module].push(q);
        });
        
        // Calcula propor√ß√£o
        const moduleNames = Object.keys(byModule);
        const result = [];
        
        moduleNames.forEach(module => {
          const moduleQuestions = byModule[module];
          const moduleCount = Math.round((moduleQuestions.length / questions.length) * total);
          
          // Seleciona quest√µes do m√≥dulo
          const selected = moduleQuestions.slice(0, Math.min(moduleCount, moduleQuestions.length));
          result.push(...selected);
        });
        
        // Completa com quest√µes restantes se necess√°rio
        if (result.length < total) {
          const remaining = questions.filter(q => !result.includes(q));
          result.push(...remaining.slice(0, total - result.length));
        }
        
        // Limita ao total
        return result.slice(0, total);
      }

      function selectCustomQuestions(questions) {
        const total = parseInt(els.configTotal.value) || 30;
        
        // Pega distribui√ß√£o dos inputs
        const distribution = {};
        $$('#moduleDistribution input[type="number"]').forEach(input => {
          const module = input.dataset.module;
          const percentage = parseInt(input.value) || 0;
          distribution[module] = percentage;
        });
        
        // Verifica se soma d√° 100%
        const totalPercent = Object.values(distribution).reduce((a, b) => a + b, 0);
        if (totalPercent !== 100) {
          alert('A soma das porcentagens deve ser 100%. Ajustando automaticamente...');
        }
        
        // Agrupa por m√≥dulo
        const byModule = {};
        questions.forEach(q => {
          if (!byModule[q.module]) byModule[q.module] = [];
          byModule[q.module].push(q);
        });
        
        const result = [];
        
        // Distribui quest√µes
        Object.entries(distribution).forEach(([module, percent]) => {
          if (percent > 0 && byModule[module]) {
            const moduleQuestions = byModule[module];
            const moduleCount = Math.round((percent / 100) * total);
            
            if (moduleCount > 0) {
              const selected = moduleQuestions.slice(0, Math.min(moduleCount, moduleQuestions.length));
              result.push(...selected);
            }
          }
        });
        
        // Completa se necess√°rio
        if (result.length < total) {
          const remaining = questions.filter(q => !result.includes(q));
          result.push(...remaining.slice(0, total - result.length));
        }
        
        return result.slice(0, total);
      }

      // =========================
      // QUIZ RENDERING
      // =========================
      function renderQuestion() {
        const q = state.currentQuestion;
        if (!q) return;

        const optionsHtml = Object.entries(q.options)
          .filter(([key, value]) => value && value.trim())
          .map(([key, value]) => `
            <div class="option" data-option="${key}">
              <div class="option-letter">${key}</div>
              <div class="option-text">${value}</div>
              <button class="option-remove" data-option="${key}" title="Desconsiderar esta alternativa">‚úï</button>
            </div>
          `).join('');

        const answered = state.answers.find(a => a.questionId === q.id);
        let questionClass = '';
        let explanationHtml = '';
        
        if (answered) {
          questionClass = answered.correct ? 'correct' : 'incorrect';
          if (state.config.showExplain && q.explain) {
            explanationHtml = `
              <div class="explanation-box show">
                <div class="explanation-title">Explica√ß√£o:</div>
                <div class="explanation-text">${q.explain}</div>
              </div>
            `;
          }
        }

        const html = `
          <div class="question-meta">
            <span class="question-tag">${q.module}</span>
            <span class="question-tag">${q.theme}</span>
            <span class="question-tag">${q.level}</span>
          </div>
          
          <h2 class="question-title">Quest√£o ${state.currentIndex + 1} de ${state.queue.length}</h2>
          
          <div class="question-text">
            ${q.q}
          </div>
          
          <div class="options-container" id="optionsContainer">
            ${optionsHtml}
          </div>
          
          ${explanationHtml}
          
          <div class="quiz-actions">
            <button class="btn btn-ghost" id="btnPrev" ${state.currentIndex === 0 ? 'disabled' : ''}>
              ‚Üê Anterior
            </button>
            <button class="btn" id="btnCheck" ${answered ? 'disabled' : ''}>
              ${answered ? '‚úì Respondida' : 'Corrigir Quest√£o'}
            </button>
            <button class="btn btn-primary" id="btnNext">
              ${state.currentIndex === state.queue.length - 1 ? 'Finalizar' : 'Pr√≥xima ‚Üí'}
            </button>
          </div>
        `;

        els.questionContent.innerHTML = html;
        els.quizProgress.textContent = `Quest√£o ${state.currentIndex + 1}/${state.queue.length}`;
        
        // Aplica estado das op√ß√µes
        if (answered) {
          const correctOption = $(`.option[data-option="${q.answer}"]`);
          const selectedOption = $(`.option[data-option="${answered.selected}"]`);
          
          if (correctOption) correctOption.classList.add('correct');
          if (selectedOption && !answered.correct) {
            selectedOption.classList.add('incorrect');
          }
        }
        
        // Adiciona listeners
        setupQuestionListeners();
      }

      function setupQuestionListeners() {
        // Sele√ß√£o de op√ß√µes
        $$('.option').forEach(option => {
          option.addEventListener('click', function(e) {
            if (!e.target.classList.contains('option-remove')) {
              selectOption(this.dataset.option);
            }
          });
        });

        // Bot√£o de remover alternativa
        $$('.option-remove').forEach(btn => {
          btn.addEventListener('click', function(e) {
            e.stopPropagation();
            const option = this.closest('.option');
            option.classList.add('disabled');
            this.style.display = 'none';
          });
        });

        // Bot√£o de corrigir
        const btnCheck = $('#btnCheck');
        if (btnCheck) {
          btnCheck.addEventListener('click', checkAnswer);
        }

        // Bot√µes de navega√ß√£o
        const btnPrev = $('#btnPrev');
        if (btnPrev) {
          btnPrev.addEventListener('click', () => navigateQuestion(-1));
        }

        const btnNext = $('#btnNext');
        if (btnNext) {
          btnNext.addEventListener('click', () => navigateQuestion(1));
        }
      }

      function selectOption(option) {
        const q = state.currentQuestion;
        const answered = state.answers.find(a => a.questionId === q.id);
        
        if (answered) return;
        
        // Remove sele√ß√£o anterior
        $$('.option').forEach(opt => opt.classList.remove('selected'));
        
        // Adiciona sele√ß√£o atual
        const selectedOpt = $(`.option[data-option="${option}"]`);
        if (selectedOpt) {
          selectedOpt.classList.add('selected');
        }
      }

      function checkAnswer() {
        const q = state.currentQuestion;
        const selectedOpt = $('.option.selected');
        
        if (!selectedOpt) {
          alert('Selecione uma alternativa primeiro.');
          return;
        }
        
        const selected = selectedOpt.dataset.option;
        const correct = selected === q.answer;
        
        // Salva resposta
        const answer = {
          questionId: q.id,
          selected: selected,
          correct: correct,
          time: Date.now() - state.startTime,
          question: q
        };
        
        state.answers.push(answer);
        
        // Atualiza estat√≠sticas
        updateStats();
        
        // Atualiza hist√≥rico
        addToHistory(q.id);
        
        // Renderiza novamente para mostrar corre√ß√£o
        renderQuestion();
        
        // Salva sess√£o
        saveSession();
      }

      function navigateQuestion(direction) {
        const newIndex = state.currentIndex + direction;
        
        if (newIndex >= 0 && newIndex < state.queue.length) {
          state.currentIndex = newIndex;
          state.currentQuestion = state.queue[newIndex];
          renderQuestion();
          
          // Salva sess√£o
          saveSession();
        } else if (newIndex >= state.queue.length) {
          finishQuiz();
        }
      }

      // =========================
      // TIMER FUNCTIONS
      // =========================
      function startTimer() {
        if (state.timer) clearInterval(state.timer);
        
        state.startTime = Date.now();
        state.timer = setInterval(() => {
          state.elapsedTime = Math.floor((Date.now() - state.startTime) / 1000);
          
          // Atualiza timers
          els.quizTimer.textContent = formatTime(state.elapsedTime);
          els.examTimer.textContent = formatTime(state.elapsedTime);
          els.statTime.textContent = formatTime(state.elapsedTime);
        }, 1000);
      }

      function stopTimer() {
        if (state.timer) {
          clearInterval(state.timer);
          state.timer = null;
        }
      }

      // =========================
      // SESSION MANAGEMENT
      // =========================
      function saveSession() {
        const session = {
          queue: state.queue.map(q => q.id),
          currentIndex: state.currentIndex,
          answers: state.answers,
          startTime: state.startTime,
          config: state.config,
          elapsedTime: state.elapsedTime
        };
        
        saveToStorage(STORAGE_KEYS.SESSION, session);
      }

      function loadSession() {
        const session = loadFromStorage(STORAGE_KEYS.SESSION);
        if (!session) return false;
        
        // Reconstr√≥i queue
        const idMap = new Map(state.questions.map(q => [q.id, q]));
        state.queue = session.queue.map(id => idMap.get(id)).filter(Boolean);
        
        if (state.queue.length === 0) return false;
        
        state.currentIndex = session.currentIndex || 0;
        state.answers = session.answers || [];
        state.config = { ...state.config, ...session.config };
        state.startTime = session.startTime || Date.now();
        state.elapsedTime = session.elapsedTime || 0;
        
        state.currentQuestion = state.queue[state.currentIndex];
        
        // Atualiza switches
        updateSwitches();
        
        // Inicia timer
        startTimer();
        
        return true;
      }

      function clearSession() {
        localStorage.removeItem(STORAGE_KEYS.SESSION);
        state.queue = [];
        state.answers = [];
        state.currentIndex = 0;
        state.currentQuestion = null;
        stopTimer();
      }

      // =========================
      // HISTORY MANAGEMENT
      // =========================
      function addToHistory(questionId) {
        const history = loadFromStorage(STORAGE_KEYS.HISTORY) || [];
        if (!history.includes(questionId)) {
          history.push(questionId);
          saveToStorage(STORAGE_KEYS.HISTORY, history);
        }
      }

      function getHistory() {
        return loadFromStorage(STORAGE_KEYS.HISTORY) || [];
      }

      // =========================
      // STATISTICS
      // =========================
      function updateStats() {
        const totalAnswered = state.answers.length;
        const correctAnswers = state.answers.filter(a => a.correct).length;
        const accuracy = totalAnswered > 0 ? Math.round((correctAnswers / totalAnswered) * 100) : 0;
        
        state.stats.totalAnswered = totalAnswered;
        state.stats.correctAnswers = correctAnswers;
        state.stats.timeSpent += state.elapsedTime;
        state.stats.lastSession = new Date().toISOString();
        
        // Atualiza UI
        els.statProgress.textContent = `${totalAnswered}/${state.queue.length}`;
        els.statAccuracy.textContent = `${accuracy}%`;
        els.statAccuracyHome.textContent = `${accuracy}%`;
        els.statAnswered.textContent = totalAnswered;
        
        // Atualiza badges
        els.navQuizBadge.textContent = state.queue.length;
        els.navDashboardBadge.textContent = totalAnswered > 0 ? 'üìà' : 'üìä';
        
        // Salva estat√≠sticas
        saveToStorage(STORAGE_KEYS.STATS, state.stats);
      }

      function updateQuestionStats() {
        els.statTotalQuestions.textContent = state.questions.length;
        els.topbarQuestions.textContent = state.questions.length;
      }

      // =========================
      // DASHBOARD
      // =========================
      function renderDashboard() {
        const total = state.answers.length;
        const correct = state.answers.filter(a => a.correct).length;
        const accuracy = total > 0 ? Math.round((correct / total) * 100) : 0;
        
        // Atualiza estat√≠sticas b√°sicas
        els.dashboardAccuracy.textContent = `${accuracy}%`;
        els.dashboardTime.textContent = formatTime(state.elapsedTime);
        els.dashboardQuestions.textContent = total;
        els.dashboardCorrect.textContent = correct;
        
        // Gera gr√°ficos
        generateCharts();
        
        // Lista quest√µes erradas
        renderWrongQuestions();
      }

      function generateCharts() {
        // Gr√°fico por m√≥dulo
        const byModule = {};
        state.answers.forEach(answer => {
          const module = answer.question.module;
          if (!byModule[module]) {
            byModule[module] = { total: 0, correct: 0 };
          }
          byModule[module].total++;
          if (answer.correct) byModule[module].correct++;
        });
        
        const moduleCtx = $('#chartModule').getContext('2d');
        new Chart(moduleCtx, {
          type: 'bar',
          data: {
            labels: Object.keys(byModule),
            datasets: [{
              label: 'Acertos',
              data: Object.values(byModule).map(m => m.correct),
              backgroundColor: '#3b82f6'
            }, {
              label: 'Total',
              data: Object.values(byModule).map(m => m.total),
              backgroundColor: '#cbd5e1'
            }]
          },
          options: {
            responsive: true,
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });
        
        // Gr√°fico por dificuldade
        const byLevel = {};
        state.answers.forEach(answer => {
          const level = answer.question.level;
          if (!byLevel[level]) {
            byLevel[level] = { total: 0, correct: 0 };
          }
          byLevel[level].total++;
          if (answer.correct) byLevel[level].correct++;
        });
        
        const levelCtx = $('#chartDifficulty').getContext('2d');
        new Chart(levelCtx, {
          type: 'doughnut',
          data: {
            labels: Object.keys(byLevel),
            datasets: [{
              data: Object.values(byLevel).map(l => l.correct),
              backgroundColor: ['#22c55e', '#f59e0b', '#ef4444']
            }]
          }
        });
      }

      function renderWrongQuestions() {
        const wrong = state.answers.filter(a => !a.correct);
        const container = $('#wrongQuestionsList');
        
        if (wrong.length === 0) {
          container.innerHTML = '<p style="color: var(--muted); text-align: center;">Nenhuma quest√£o errada! üéâ</p>';
          return;
        }
        
        let html = '<div style="display: flex; flex-direction: column; gap: 12px;">';
        wrong.forEach((answer, index) => {
          html += `
            <div style="padding: 16px; border: 1px solid var(--border); border-radius: var(--radius-md);">
              <div style="font-weight: 600; color: var(--danger-600); margin-bottom: 8px;">
                ${index + 1}. ${answer.question.q.substring(0, 100)}...
              </div>
              <div style="font-size: 14px; color: var(--muted);">
                M√≥dulo: ${answer.question.module} | 
                Sua resposta: ${answer.selected} | 
                Correta: ${answer.question.answer}
              </div>
            </div>
          `;
        });
        html += '</div>';
        
        container.innerHTML = html;
      }

      // =========================
      // UI UPDATES
      // =========================
      function updateUI() {
        // Atualiza modo
        els.topbarMode.textContent = state.config.examMode ? 'Prova' : 'Treino';
        
        // Atualiza estat√≠sticas
        updateQuestionStats();
        updateStats();
        
        // Atualiza switches
        updateSwitches();
      }

      function updateSwitches() {
        const switches = {
          'switchNoRepeat': state.config.noRepeat,
          'switchShuffle': state.config.shuffle,
          'switchExplain': state.config.showExplain,
          'switchExam': state.config.examMode
        };
        
        Object.entries(switches).forEach(([id, value]) => {
          const el = document.getElementById(id);
          if (el) {
            el.classList.toggle('on', value);
            el.setAttribute('aria-checked', value);
          }
        });
      }

      // =========================
      // EVENT HANDLERS
      // =========================
      function setupEventListeners() {
        // Login
        els.btnLogin.addEventListener('click', () => {
          const email = $('#loginEmail').value;
          const password = $('#loginPassword').value;
          
          if (!email || !password) {
            alert('Preencha e-mail e senha');
            return;
          }
          
          loginUser(email, password);
        });

        // A√ß√µes da home
        els.actionNew.addEventListener('click', openConfigModal);
        els.actionContinue.addEventListener('click', () => {
          if (loadSession()) {
            showView('quiz');
            renderQuestion();
          } else {
            alert('Nenhuma sess√£o para continuar.');
          }
        });
        els.actionDashboard.addEventListener('click', () => {
          if (state.answers.length > 0) {
            renderDashboard();
            showView('dashboard');
          } else {
            alert('Complete um simulado primeiro para ver o dashboard.');
          }
        });
        els.actionQuickExam.addEventListener('click', () => {
          state.config.examMode = true;
          els.switchExam.classList.add('on');
          openConfigModal();
        });

        // Config modal
        els.startConfig.addEventListener('click', () => {
          if (buildQuestionQueue()) {
            els.modalConfig.classList.remove('active');
            showView('quiz');
            renderQuestion();
            
            // Se for modo prova, ativa overlay
            if (state.config.examMode) {
              els.examOverlay.classList.add('active');
              renderExamQuestion();
            }
          }
        });

        els.closeConfig.addEventListener('click', () => {
          els.modalConfig.classList.remove('active');
        });

        els.cancelConfig.addEventListener('click', () => {
          els.modalConfig.classList.remove('active');
        });

        // Exam overlay
        els.exitExam.addEventListener('click', () => {
          if (confirm('Deseja realmente sair da prova? Seu progresso ser√° salvo.')) {
            els.examOverlay.classList.remove('active');
            showView('home');
            saveSession();
          }
        });

        // Navega√ß√£o
        els.btnBackHome.addEventListener('click', () => {
          if (state.config.examMode && confirm('Sair do modo prova?')) {
            state.config.examMode = false;
            els.app.classList.remove('exam-mode');
            els.examOverlay.classList.remove('active');
          }
          showView('home');
        });

        els.btnLogout.addEventListener('click', logoutUser);
        
        els.btnResetData.addEventListener('click', () => {
          if (confirm('Tem certeza? Todos os dados ser√£o apagados.')) {
            clearStorage();
            location.reload();
          }
        });

        // Switches
        els.switchNoRepeat.addEventListener('click', () => {
          state.config.noRepeat = !state.config.noRepeat;
          els.switchNoRepeat.classList.toggle('on', state.config.noRepeat);
          saveToStorage(STORAGE_KEYS.CONFIG, state.config);
        });

        els.switchShuffle.addEventListener('click', () => {
          state.config.shuffle = !state.config.shuffle;
          els.switchShuffle.classList.toggle('on', state.config.shuffle);
          saveToStorage(STORAGE_KEYS.CONFIG, state.config);
        });

        els.switchExplain.addEventListener('click', () => {
          state.config.showExplain = !state.config.showExplain;
          els.switchExplain.classList.toggle('on', state.config.showExplain);
          saveToStorage(STORAGE_KEYS.CONFIG, state.config);
        });

        els.switchExam.addEventListener('click', () => {
          state.config.examMode = !state.config.examMode;
          els.switchExam.classList.toggle('on', state.config.examMode);
          saveToStorage(STORAGE_KEYS.CONFIG, state.config);
          els.topbarMode.textContent = state.config.examMode ? 'Prova' : 'Treino';
        });

        // Navega√ß√£o por views
        $$('.nav-item[data-view]').forEach(item => {
          item.addEventListener('click', function() {
            const view = this.dataset.view;
            showView(view);
            
            if (view === 'dashboard' && state.answers.length > 0) {
              renderDashboard();
            }
          });
        });
      }

      // =========================
      // EXAM MODE
      // =========================
      function renderExamQuestion() {
        const q = state.currentQuestion;
        if (!q) return;

        const optionsHtml = Object.entries(q.options)
          .filter(([key, value]) => value && value.trim())
          .map(([key, value]) => `
            <div class="option" data-option="${key}">
              <div class="option-letter">${key}</div>
              <div class="option-text">${value}</div>
              <button class="option-remove" data-option="${key}" title="Desconsiderar esta alternativa">‚úï</button>
            </div>
          `).join('');

        const html = `
          <div class="question-meta">
            <span class="question-tag">${q.module}</span>
            <span class="question-tag">${q.theme}</span>
            <span class="question-tag">${q.level}</span>
          </div>
          
          <h2 class="question-title">Quest√£o ${state.currentIndex + 1} de ${state.queue.length}</h2>
          
          <div class="question-text">
            ${q.q}
          </div>
          
          <div class="options-container">
            ${optionsHtml}
          </div>
          
          <div class="quiz-actions">
            <button class="btn btn-ghost" id="examBtnPrev" ${state.currentIndex === 0 ? 'disabled' : ''}>
              ‚Üê Anterior
            </button>
            <button class="btn" id="examBtnCheck">
              Corrigir Quest√£o
            </button>
            <button class="btn btn-primary" id="examBtnNext">
              ${state.currentIndex === state.queue.length - 1 ? 'Finalizar Prova' : 'Pr√≥xima ‚Üí'}
            </button>
          </div>
        `;

        els.examContent.innerHTML = html;
        els.examProgress.textContent = `Quest√£o ${state.currentIndex + 1}/${state.queue.length}`;
        
        // Adiciona listeners espec√≠ficos do modo prova
        setupExamListeners();
      }

      function setupExamListeners() {
        // Sele√ß√£o de op√ß√µes
        $$('.exam-container .option').forEach(option => {
          option.addEventListener('click', function(e) {
            if (!e.target.classList.contains('option-remove')) {
              const selected = this.dataset.option;
              selectOption(selected);
            }
          });
        });

        // Bot√£o de remover alternativa
        $$('.exam-container .option-remove').forEach(btn => {
          btn.addEventListener('click', function(e) {
            e.stopPropagation();
            const option = this.closest('.option');
            option.classList.add('disabled');
            this.style.display = 'none';
          });
        });

        // Bot√µes de navega√ß√£o
        $('#examBtnPrev')?.addEventListener('click', () => {
          state.currentIndex = Math.max(0, state.currentIndex - 1);
          state.currentQuestion = state.queue[state.currentIndex];
          renderExamQuestion();
        });

        $('#examBtnNext')?.addEventListener('click', () => {
          if (state.currentIndex === state.queue.length - 1) {
            finishExam();
          } else {
            state.currentIndex++;
            state.currentQuestion = state.queue[state.currentIndex];
            renderExamQuestion();
          }
        });

        $('#examBtnCheck')?.addEventListener('click', checkExamAnswer);
      }

      function checkExamAnswer() {
        const q = state.currentQuestion;
        const selectedOpt = $('.exam-container .option.selected');
        
        if (!selectedOpt) {
          alert('Selecione uma alternativa primeiro.');
          return;
        }
        
        const selected = selectedOpt.dataset.option;
        const correct = selected === q.answer;
        
        // Salva resposta
        const answer = {
          questionId: q.id,
          selected: selected,
          correct: correct,
          time: Date.now() - state.startTime,
          question: q
        };
        
        state.answers.push(answer);
        
        // Mostra resultado
        const correctOption = $(`.exam-container .option[data-option="${q.answer}"]`);
        const selectedOption = $(`.exam-container .option[data-option="${selected}"]`);
        
        if (correctOption) correctOption.classList.add('correct');
        if (selectedOption && !correct) {
          selectedOption.classList.add('incorrect');
        }
        
        // Desabilita bot√£o
        $('#examBtnCheck').disabled = true;
        
        // Salva sess√£o
        saveSession();
      }

      function finishExam() {
        stopTimer();
        els.examOverlay.classList.remove('active');
        state.config.examMode = false;
        
        // Mostra resultados
        renderDashboard();
        showView('dashboard');
        
        alert('Prova finalizada! Confira seu desempenho no dashboard.');
      }

      function finishQuiz() {
        stopTimer();
        saveSession();
        renderDashboard();
        showView('dashboard');
      }

      // =========================
      // INITIALIZATION
      // =========================
      async function init() {
        // Carrega quest√µes
        await loadQuestions();
        
        // Verifica se tem usu√°rio logado
        const savedUser = loadFromStorage(STORAGE_KEYS.USER);
        if (savedUser) {
          state.user = savedUser;
          
          // Carrega configura√ß√µes
          const savedConfig = loadFromStorage(STORAGE_KEYS.CONFIG);
          if (savedConfig) {
            state.config = { ...state.config, ...savedConfig };
          }
          
          // Carrega estat√≠sticas
          const savedStats = loadFromStorage(STORAGE_KEYS.STATS);
          if (savedStats) {
            state.stats = savedStats;
          }
          
          showView('home');
          updateUI();
        } else {
          showView('login');
        }
        
        // Configura event listeners
        setupEventListeners();
        
        // Permite upload de arquivo JSON
        setupFileUpload();
      }

      function setupFileUpload() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        input.style.display = 'none';
        document.body.appendChild(input);
        
        // Bot√£o para upload (adicionar no UI se quiser)
        // Por enquanto, apenas debug
        console.log('Para fazer upload de arquivo JSON, use o console:');
        console.log('window.uploadQuestions(file)');
        
        window.uploadQuestions = async function(file) {
          try {
            const text = await file.text();
            const data = JSON.parse(text);
            const sanitized = sanitizeQuestions(data);
            
            if (sanitized.length > 0) {
              state.questions = sanitized;
              saveToStorage(STORAGE_KEYS.QUESTIONS, sanitized);
              updateQuestionStats();
              alert(`Carregadas ${sanitized.length} quest√µes com sucesso!`);
              location.reload();
            } else {
              alert('Nenhuma quest√£o v√°lida encontrada no arquivo.');
            }
          } catch (error) {
            alert('Erro ao processar arquivo: ' + error.message);
          }
        };
      }

      // Inicia a aplica√ß√£o
      init();
      
      // Torna o estado dispon√≠vel para debug
      window.pqoState = state;
    })();
  </script>
</body>
</html>